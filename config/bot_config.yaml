# config/bot_config.yaml
# ────────────────────────────────────────────────────────────────
# ГЛАВНЫЙ КОНФИГ-ФАЙЛ — здесь настраивается ВСЁ
# После редактирования запускай: python scripts/run_bot.py
# Каждый параметр описан подробно: зачем, влияние, разумные значения, риски
# ────────────────────────────────────────────────────────────────

# 1. Общие настройки системы
general:
  deposit: 10000.0
  # Зачем: начальный виртуальный депозит в USDT для расчёта риска и размера позиции.
  # Влияет на: абсолютный размер позиции и общую просадку в %.
  # Разумные значения: 5000–50000 USDT.
  # Повышение: позиции крупнее → прибыль/убытки растут пропорционально.
  # Понижение: позиции мелкие → комиссия и slippage съедают всю прибыль.
  # Риск: слишком маленький депозит → неэффективная торговля.

  commission_rate: 0.0004
  # Зачем: моделирует комиссию Binance Futures round-trip.
  # Влияет на: итоговый P&L в виртуальном и реальном режиме.
  # Разумные значения: 0.0002–0.0006 (проверь актуальную на бирже).
  # Повышение: P&L пессимистичнее → PR падает.
  # Понижение: P&L завышается → переоценка стратегии.

  slippage_rate: 0.001
  # Зачем: моделирует проскальзывание цены в виртуальном трейдере.
  # Влияет на: реалистичность P&L в симуляции.
  # Разумные значения: 0.0005–0.003 (выше для волатильных монет).
  # Повышение: симуляция жёстче → PR падает.
  # Понижение: симуляция завышает PR (нереалистично).

  debug: false
  # Зачем: включает очень подробные логи.
  # Влияет на: скорость работы и размер логов.
  # Разумные значения: false в продакшене, true только при отладке.
  # Повышение (true): сильно замедляет бота, особенно на телефоне.
  # Понижение (false): чистые логи, высокая скорость.

  quiet_mode: false
  # Зачем: разрешает торговлю в тихом рынке (q_condition = true).
  # Влияет на: количество сделок в боковике.
  # Разумные значения: false на старте.
  # Повышение (true): больше сделок, но выше риск ложных входов.
  # Понижение (false): фильтрует боковик → стабильнее, меньше сделок.

# 2. Версия железа (обязательно выбрать одну)
hardware:
  mode: "colab"
  # Зачем: определяет режим работы всего проекта.
  # Влияет на: размер модели, batch_size, объём данных для обучения, кэш, скорость.
  # Варианты: phone_tiny / colab / server.
  # Повышение (server): максимальная производительность и качество.
  # Понижение (phone_tiny): упрощённая модель, ограниченный объём данных.

# 3. Режим агрессивности (влияет на риск, пороги, фильтры)
trading_mode:
  mode: "balanced"
  # Зачем: задаёт общую агрессивность стратегии.
  # Влияет на: риск на сделку, частоту входов, профит-фактор.
  # Варианты: conservative / balanced / aggressive / custom.
  # Повышение (aggressive): больше сделок, выше потенциальная прибыль, выше просадка.
  # Понижение (conservative): стабильнее, ниже прибыль.

  real_trading: false
  # Зачем: включает реальную торговлю.
  # Влияет на: реальный капитал.
  # Разумные значения: false на старте.
  # Повышение (true): бот торгует реальными деньгами.
  # Понижение (false): только симуляция.

  auto_mode_switch: false
  # Зачем: авто-переключение режимов агрессивности по просадке/PR.
  # Влияет на: адаптивность к рынку.
  # Разумные значения: false (пока не реализовано).
  # Повышение (true): бот сам адаптируется.
  # Риски: при ошибке в логике может быстро слить депозит.

# 4. Настройки нейронки (архитектура и обучение)
model:
  in_features: 16
  # Зачем: количество входных признаков модели.
  # Влияет на: архитектуру нейронки.
  # Фиксировано 16 (12 базовых + 4 бинарных). Не меняй.

  windows: [24, 50, 74, 100]
  # Зачем: окна анализа свечей до аномалии.
  # Влияет на: качество предсказания и объём данных для обучения.
  # Повышение: больше окон → лучше качество, но тяжелее.
  # Понижение: быстрее, но хуже предсказания.

  hidden_size: 64
  # Зачем: размер скрытого слоя GRU.
  # Влияет на: качество модели и потребление памяти.
  # Повышение: точнее модель, но больше памяти и медленнее.
  # Понижение: проще модель, быстрее, но хуже качество.

  dropout: 0.1
  # Зачем: защита от переобучения.
  # Влияет на: обобщающую способность модели.
  # Повышение: меньше переобучение, но может ухудшить качество.
  # Понижение: выше риск переобучения.

  learning_rate: 0.001
  # Зачем: скорость обучения модели.
  # Влияет на: скорость сходимости и качество.
  # Повышение: быстрее сходится, но может не дойти до минимума.
  # Понижение: сходится очень медленно.

  epochs: 30
  # Зачем: максимальное количество эпох обучения.
  # Влияет на: время обучения.
  # Повышение: больше шанс найти хороший минимум.
  # Понижение: быстрее обучение, но хуже модель.

  batch_size: 32
  # Зачем: количество примеров за один шаг обучения.
  # Влияет на: скорость и стабильность градиентов.
  # Повышение: быстрее обучение, но выше потребление памяти.
  # Понижение: стабильнее, но медленнее.

  patience: 8
  # Зачем: early stopping (ранняя остановка).
  # Влияет на: предотвращение переобучения.
  # Повышение: модель обучается дольше.
  # Понижение: быстрее останавливается, может недообучиться.

# 5. Настройки TP/SL (самый важный блок для прибыли/риска)
tp_sl:
  mode: "partial_trailing"
  # Зачем: режим фиксации прибыли.
  # Влияет на: профит-фактор и просадку.
  # Варианты: classic / partial_trailing / dynamic_level / chandelier.
  # Повышение (partial_trailing): ловит сильные движения, выше потенциал.
  # Понижение (classic): стабильнее, но ниже прибыль.

  tp1_mult: 1.0
  # Зачем: множитель средней свечи для TP1.
  # Влияет на: когда срабатывает первая фиксация.
  # Повышение: TP1 дальше → реже срабатывает.
  # Понижение: TP1 ближе → чаще фиксируем прибыль.

  tp1_portion: 0.50
  # Зачем: доля позиции на TP1.
  # Влияет на: сколько фиксируем рано.
  # Повышение: выше winrate, ниже потенциальная прибыль.
  # Понижение: больше позиции в трейлинге → выше потенциал.

  tp2_mult: 1.5
  # Зачем: множитель для TP2.
  # Влияет на: когда срабатывает TP2.

  tp2_portion: 0.30
  # Зачем: доля позиции на TP2.

  trailing_portion: 0.20
  # Зачем: доля позиции в трейлинге.
  # Влияет на: ловлю сильных движений.

  trailing_distance_mult: 0.5
  # Зачем: расстояние трейлинг-стопа.
  # Влияет на: как близко двигается стоп.
  # Повышение: стоп дальше → реже выбивает.
  # Понижение: стоп ближе → чаще фиксируем.

# 6. Настройки риска
risk:
  risk_per_trade: 1.0
  # Зачем: риск на одну сделку в % от депозита.
  # Влияет на: размер позиции и общую просадку.
  # Повышение: крупнее позиции → выше прибыль/убытки.
  # Понижение: мельче позиции → стабильнее, но меньше прибыли.

  max_positions: 8
  # Зачем: максимальное количество одновременно открытых позиций.
  # Влияет на: диверсификацию и общий риск.
  # Повышение: больше диверсификация, но выше риск.
  # Понижение: меньше риск, но меньше возможностей.

# 7. Фильтры монет (после бэктеста)
filters:
  min_age_months: 3
  # Зачем: минимальный возраст монеты на бирже (месяцев).
  # Влияет на: отбор стабильных монет.
  # Повышение: только очень старые монеты → меньше монет.
  # Понижение: больше новых монет → выше риск.

  min_pr_ls: 1.3
  # Зачем: минимальный PR_LS после бэктеста.
  # Влияет на: какие монеты попадают в whitelist.
  # Повышение: строже фильтр → меньше монет, но стабильнее.
  # Понижение: больше монет → выше риск.

  min_trades: 50
  # Зачем: минимальное количество сделок в бэктесте.
  # Влияет на: надёжность статистики.
  # Повышение: строже → меньше монет.
  # Понижение: больше монет → выше риск ненадёжной статистики.

# 8. Настройки аномалий (по ТЗ — без абсолютных порогов)
anomalies:
  candle_lookback: 100
  # Зачем: период для расчёта свечной аномалии.
  # Влияет на: чувствительность свечной аномалии.
  # Повышение: стабильнее, но медленнее реагирует.
  # Понижение: быстрее реагирует, но больше ложных.

  volume_lookback: 25
  # Зачем: период для расчёта объёмной аномалии.
  # Влияет на: чувствительность объёмной аномалии.

# 9. Настройки признаков
features:
  channel_period: 100
  # Зачем: период ценового канала.
  # Влияет на: расчёт признака price_channel_pos.

  va_bins: 50
  # Зачем: количество бинов для Value Area 60%.
  # Влияет на: качество расчёта VA.

# 10. Backtest & Warm-up
backtest:
  # limit_candles здесь больше не используется (бэктест всегда берёт 250 свечей)

warmup:
  enabled: true
  # Зачем: включить прогрев перед торговлей.
  # Влияет на: качество первых сделок.

  candles_to_warmup: 1000
  # Зачем: сколько свечей прогреть.
  # Влияет на: актуальность кэша resampler.
  # Повышение: дольше старт, но стабильнее первые сделки.
  # Понижение: быстрее старт, но первые сделки могут быть хуже.

# 11. Дополнительные настройки
advanced:
  retrain_every_candles: 10000
  # Зачем: переобучение модели каждые N свечей в live_loop.
  # Влияет на: актуальность модели в реальном времени.

  export_scenarios_every: 0
  # Зачем: автоэкспорт статистики сценариев каждые N секунд.
  # Влияет на: оперативность мониторинга.

  auto_mode_switch: false
  # Зачем: авто-переключение режимов агрессивности.
  # Влияет на: адаптивность к рынку.

  websocket_batch_size: 40
  # Зачем: размер батча подписки на WebSocket.
  # Влияет на: стабильность подключения к Binance.

# 12. Настройки обучения (trainer.py)
training:
  max_candles_per_tf_phone: 30000
  # Зачем: максимум свечей на каждый TF для обучения на телефоне.
  # Влияет на: объём данных и скорость обучения на слабом железе.

  max_candles_per_tf_colab: 200000
  # Зачем: максимум свечей на каждый TF для обучения на Colab.
  # 0 = без лимита → вся история.
  # Влияет на: качество модели на Colab.

  max_candles_per_tf_server: 0
  # Зачем: максимум свечей на каждый TF для обучения на сервере.
  # 0 = без лимита → вся история.
  # Влияет на: максимальное качество модели на мощном железе.